// Generated by CoffeeScript 1.10.0
(function() {
  var Parser, Parts, Scope, Util, error, log, tools;

  tools = require("monky-tools");

  Parts = require("./parts/parts");

  Scope = require("./parts/scope");

  Util = require("./util");

  log = tools.console.log;

  error = tools.console.error;

  Parser = (function() {
    function Parser() {}

    Parser.process = function(line) {
      return line = line.toLowerCase();
    };

    Parser.phrasify = function(line) {
      var i, index, indices, j, len, pattern, phrases, result;
      pattern = Util.regex.group(Parts.keywords);
      indices = [];
      while (true) {
        result = pattern.exec(line);
        if (result != null) {
          indices.push(result.index);
        } else {
          break;
        }
      }
      indices.sort(function(a, b) {
        return a > b;
      });
      phrases = [];
      for (i = j = 0, len = indices.length; j < len; i = ++j) {
        index = indices[i];
        if (indices[i + 1] == null) {
          phrases.push(line.slice(index));
          break;
        } else {
          phrases.push(line.slice(index, indices[i + 1]));
        }
      }
      return phrases;
    };

    Parser.parse = function(line) {
      var j, k, len, len1, phrase, phrases, ref, result, segments, verb;
      line = this.process(line);
      segments = [];
      phrases = this.phrasify(line);
      for (j = 0, len = phrases.length; j < len; j++) {
        phrase = phrases[j];

        /* ADVERB */
        result = Parts.adverb.test(phrase);
        if (result != null) {
          segments.push(result);
        }

        /* VERBS */
        ref = Parts.verbs;
        for (k = 0, len1 = ref.length; k < len1; k++) {
          verb = ref[k];
          result = verb.test(phrase);
          if (result != null) {
            Scope.type = 'verb';
            Scope.subtype = verb.lexical.base;
            segments.push(result);
          }
        }
      }
      return segments;
    };

    return Parser;

  })();

  module.exports = Parser;

}).call(this);
